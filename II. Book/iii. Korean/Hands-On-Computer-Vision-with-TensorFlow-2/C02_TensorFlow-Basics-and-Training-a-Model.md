# Chapter 2. 텐서플로 기초와 모델 훈련

## 2.1. 기술적 요구사항

## 2.2. 텐서플로 2와 케라스 시작하기

### 2.2.1. 텐서플로 소개

### 2.2.2. 케라스를 사용한 간단한 컴퓨터 비전 모델

```Python
import tensorflow as tf

num_classes = 10
img_rows, img_cols = 28, 28
num_channels = 1
input_shaep = (img_rows, img_cols, num_channels)

(x_train, y_train), (x_test, y_test) = tf.keras.datasets.mnist.load_data()
x_train, x_test = x_train / 255.0, x_test / 255.0

model = tf.keras.models.Sequential()
model.add(tf.keras.layers.Flatten())
model.add(tf.keras.layers.Dense(128, activation='relu'))
model.add(tf.keras.layers.Dense(num_classes, activation='softmax'))

model.summary()

model.compile(optimize='sgd',
    loss='sparse_categorical_crossentropy',
    metrics=['accuracy']

model.fit(x_train, y_train, epochs=5, verbose=1, validation_data=(x_test, y_test))
```

## 2.3. 텐서플로 2와 케라스 자세히 알아보기 :star:

### 2.3.1. 핵심개념

- 텐서 소개

- 텐서플로 그래프

- 느긋한 실행과 조급한 실행 비교

- 텐서플로 2에서 그래프 생성하기

- 텐서플로 오토그래프와 tf.function 소개
```Python
@tf.function
def compute(a, b, c):
    d = a * b + c
    e = a * b * c
    return d, e
```

- 그래디언트 테이프를 사용해 오차 역전파하기

### 2.3.2. 고급 개념

오토그래프 모듈, tf.function 데코레이터, 그래디언트 테이프 컨텍스트는 보이지 않는 곳에서 그래프를 생성하고 관리하는 작업을 매우 간단하게 만든다. 이 절에서는 내부 작동 방식에 대해서 설명한다.

### tf.function 작동 방식

### 텐서플로 2의 변수

### 분산전력

### 에스티메이터 API 사용하기

### 사전 제작된 에스티메이터

### 맞춤형 에스티메이터 훈련시키기

## 2.4. 텐서플로 생태계

주요 라이브러리 외에서 텐서틀로는 머신러닝에 유용한 다양한 도구를 제공한다. 그 중 일부는 텐서플로로 제공되지만, 텐서플로 익스텐디드(TensorFlow Extended, TFX)로 묶여 제공되거나 텐서플로 애드온(TensorFlow Addons)으로 제공되는 것도 있다.

### 2.4.1. 텐서보드

텐서플로는 강력한 모니터링 도구로 텐서보드(TensorBoard)를 제공한다. 텐서플로를 설치하면 기본으로 설치되기 때문에 케라스의 콜백과 결합해 사용하기가 매우 쉽다.

```Python
callbacks = [tf.keras.callbacks.TensorBoard('./logs_keras')]
model.fit(x_train, y_train, epochs=5, verbose=1, validation_data=(x_test, y_test), callbacks=callbacks)
```

이 업데이트된 코드에서 텐서보드 콜백을 model.fit() 메서드에 전달한다. 기본적으로 텐서플로는 지정된 폴더에 손실과 메트릭을 자동으로 기록한다. 그런 다음 명령줄에서 텐서보드를 실행하면 된다.

```bash
$ tensorboard --logdir ./logs_keras
```

이 명령어는 텐서보드 인터페이스를 표시하기 위해 열 수 있는 URL을 출력한다. Scalars 탭에서 손실과 정확도를 표시하는 그래프를 확인할 수 있다.

딥러닝 모델은 여러 차례의 미세 조정이 필요하다. 따라서 직접 만든 모델의 성능을 모니터링하는 것이 매우 중요하다. 텐서보드가 하는 일이 바로 이것이다. 그 중 시간에 따라 모델 손실이 어떻게 개선되는지 모니터링하기 위해 텐서보드를 사용하는 것이 가장 보편적이다. 그외에도 다음 작업을 할 수 있다.

- 메트릭(예: 정확도) 그래프 그리기
- 입출력 이미지 표시
- 실행 시간 표시
- 모델의 그래프 표현 그리기

텐서보드는 매우 다양한 용도를 갖고 있고 이를 사용하는 방법은 여러 가지가 있다. 각 정보는 tf.summnary에 저장된다. 그 정보는 스칼라일 수도 있고, 이미지나 히스토그램, 텍스트일 수도 있다. 

텐서보드에서 메트릭 로그를 남기도록 설정하는 것은 다소 복잡하고 시간이 걸리지만, 텐서플로 툴킷의 필수 도구다. 이를 활용하면 수작업으로 로그를 남기거나 디버깅할 때 상당한 시간을 절약할 수 있다.

### 2.4.2. 텐서플로 애드온과 텐서플로 확장

텐서플로 애드온(TensorFlow Addon)은 부가적인 기능을 한 곳에 모아둔 것이다. 여기에는 딥러닝 분야에서 최근에 고안되어 메인 텐서플로 라이브러리에 추가할 만한지 판단하기에는 아직 안정적이지 않고 충분히 활용되지 못한 기법들을 담고 있다. 또한 텐서플로 1에서 제거된 tf.contrib를 대체한다.

텐서플로 확장 버전(TensorFlow Extended)은 텐서플로를 위한 엔드투엔드 머신러닝 플랫폼이다.

- TensorFlow Data Validation: 머신러닝 데이터 탐색 및 검증을 위한 라이브러리, 모델을 구성하기 전에 이것을 사용할 수 있다.
- TensorFlow Transform: 데이터 전처리를 위한 라이브러리, 이것을 사용하면 훈련 데이터와 평가 데이터가 동일한 방식으로 처리될 수 있다.
- TensorFlow Model Analysis: 텐서플로 모델 평가를 위한 라이브러리.
- TensorFlow Serving: 머신러닝 모델을 서비스하는 시스템, 모델을 서비스한다는 것은 일반적으로 REST API를 통해 모델의 예측을 전달하는 프로세스라는 뜻이다.

딥러닝 모델을 생성하고 사용하는 전체 프로세스: 데이터 검증 -> 데이터 변환 -> 모델 훈련 -> 모델 분석 -> 모델 서비스

이러한 도구는 딥러닝 모델을 구성하고 사용하는 프로세스의 모든 단계를 다뤄 모델 생애주기의 처음부터 끝까지 포괄하는 목표를 충족한다.

### 2.4.3. 텐서플로 라이트와 TensorFlow.js

텐서플로의 메인 버전은 윈도우, 리눅스, 맥 컴퓨터에서 사용할 수 있게 설계됐다. 다른 기기에서 작동시키려면 다른 버전의 텐서플로가 필요하다. 텐서플로 라이트(TensorFlow Lite)는 모바일 폰과 임베디드 기기에서 모델 예측(추론)을 실행하게 설계됐다. 그것은 텐서플로 모델은 필수 포맷인 .tflite 포맷으로 변환하는 컨버터와 추론을 실행하기 위해 모바일 디바이스에 설치될 수 있는 인터프리터로 구성된다.

좀 더 최근에는 TensorFlow.js(tfjs)가 거의 모든 웹브라우저에서 딥러닝을 사용할 수 있게 개발됐다. 이 버전은 사용자가 따로 설치할 내용은 없고 경우에 따라 시스템의 GPU 가속을 사용할 수 있다. 

### 2.4.4. 모델 실행 장소

### 로컬 컴퓨터

### 원격 시스템

:bulb: 주피터 노트북에 기반한 구글 코랩(Google Colab)을 사용하면 클라우드에서 노트북을 무료로 실행할 수 있다. 게다가 GPU 모드를 활성화할 수도 있다. 코랩은 저장 공간에 제약이 있고 연속해서 8시간 이상 실행할 수 없다. 처음 시작해서 실험해 보기에는 완벽한 도구지만, 모델 크기가 커지면 사용하기에 편리하지 않다.

### 구글 클라우드

원격 시스템에서 텐서플로를 실행하려면 원하는 소프트웨어를 설치하고 최신 버전으로 업데이트하고 서버 전원을 켜고 끄는 일까지 모두 직접 관리해야 한다. 하나의 시스템에서 그렇게 하는 것도 가능하지만, 대체로 여러 GPU에 훈련 과정을 분산 처리해야 한다. 구글 클라우드 ML을 사용해 텐서플로를 실행하면 시스템 작업이 아니라 모델에 집중할 수 있다. 구글 클라우드 ML은 다음 작업을 하는 데 유용하다.

- 클라우드의 탄력적으로 운용되는 자원 덕분에 빠르게 훈련시킨다.
- 병렬 처리로 짧은 시간 내에 최적의 모델 매개변수를 구한다.
- 모델이 준비되면 예측 서버를 실행하지 않고도 예측 서비스를 제공한다.

## 2.5. 요약

- 케라스 API를 사용해 기초적인 컴퓨터 비전 모델을 훈련시키는 방법
- 텐서플로2의 기초가 되는 주요 개념인 텐서, 그래프, 오토그래프, 조급한 실행, 그래디언트 테이프 소개
- 모니터링을 위한 텐서보드, 데이터 전처리와 모델 분석을 위한 TFX
- 필요에 따라 이 모델을 어디에서 실행하는 것이 좋은지에 대한 검토

## 2.6. 질문
