# 06 이미지 보강 및 분할

- 인코더-디코더 개념과 픽셀-수준의 예측을 위해 훈련시키는 방법
- 고차원 데이터를 출력하기 위해 인코더-디코더에서 어떤 신규 계층(언풀링, Unpooling, 전치합성곱, Transposed Convolutions, 아트루스 합성곱, Atrous Convolutions)을 사용하는가
- FCN과 U-Net 아키텍처는 어떻게 의미론적 분할을 해결하는가
- 지금까지 알아본 모델이 인스턴스 분할을 다루기 위해 어떻게 확장될 수 있는가

## 기술 요구사항

## 인코더-디코더로 이미지 변환

### 인코더-디코더 소개

#### 인코딩과 디코딩
이 프레임워크는 인코더는 입력 샘플을 잠재 공간, 즉 인코더에 의해 정의된 숨겨둔 구조화된 값 집합에 매핑하는 함수다. 디코더는 이 잠재 공간의 요소를 사전 정의된 타깃 도메인으로 매핑하는 여함수다. 예를 들어 인코더는 미디어 파일을 파싱하기 위해 생성되고(콘텐츠는 잠재 공간의 요소로 표시됨), 가령 미디어 콘텐츠를 다른 파일 포맷으로 출력하도록 정의된 디코더와 쌍을 이룰 수 있다. 잘 알려진 예로는 오늘날 보편적으로 사용하는 이미지와 오디오 압축 포맷을 들 수 있다. JPEG 도구는 미디어 파일을 보다 가벼운 이진 파일로 압축하여 인코딩하고, 표시할 때 픽셀 값을 복원하기 위해 디코딩한다.

머신러닝에서 인코더-디코더 네트워크는 오랫동안 사용돼 왔다(예: 텍스트 번역). 인코더 네트워크는 출발어(source language)의 문장을 입력으로 취하고(예: 프랑스어 문장), 문장의 의미가 특징 벡터로 인코딩된 잠재 공간으로 이 문장을 투사하는 것을 학습한다. 디코더 네트워크는 인코딩된 벡터를 도착어(target language, 예: 영어 번역)의 문장으로 변환하기 위해 인코더와 함께 훈련된다.

:bulb: 인코더-디코더 모델에서 잠재 공간의 벡터를 일반적으로 코드(code)라고 한다.

#### 오토인코딩
오토인코더(Auto-encoder, AE)는 특수한 유형의 인코더-디코더다. 오토인코더의 입력과 타깃 도메인이 동일해서 이 모델의 병목 계층(저차원의 잠재 공간)에도 불구하고 적절하게 인코딩한 다음 품질에 영향을 주지 않고 이미지를 디코딩하는 것을 목표로 한다. 입력은 압축된 표현(특징 벡터)으로 줄어든다. 원본 입력이 나중에 요청되면 디코더에 의해 압축된 표현으로부터 재구성될 수 있다. 

:bulb: 오토인코더와 관련해 머신러닝 전문가들의 의견이 나뉜다. 일부는 이 모델이 비지도 학습이라고 주장하는데, 훈련에 추가 레이블이 필요하지 않기 때문이다. 다른 전문가들은 순수 비지도 기법(전통적으로 레이블이 없는 데이터셋에서 패턴을 발견하기 위해 복잡한 손실 함수를 사용하는)과는 다르며 AE에는 명확하게 정의된 타깃(즉, 입력 이미지)이 있다고 주장한다. 따라서 이 모델을 자기 지도 학습(Self-Supervised Learning)이라고도 한다(즉 이 모델의 타깃이 입력에서 직접 파생될 수 있다).

:bulb: 병목 조건을 제외하면 이 항등 매핑은 ResNet 같은 숏컷 경로가 있는 네트워크에서 간단하다. 인코더에서 디코더로 전체 입력 정보를 전달하기만 하면 된다. 저차원 잠재 공간(병목)을 사용하면 이 너트워크는 적절히 압축된 표현을 학습해야 한다.

#### 목적

### 기본 예제 - 이미지 노이즈 제거

#### 간단한 완전 연결 오토인코더

#### 이미지 노이즈 제거에 적용

### 합성곱 인코더-디코더

#### 언풀링, 전치, 팽창
전치 합성곱(Transposed Convolution, 디컨볼루션, Deconvolution), 팽창된 합성곱(Dilated Convolution), 언풀링(Unpooling)

##### 전치 합성곱(디컨볼루션)

##### 언풀링

##### 업샘플링과 크기 조정

##### 팽창된/아트루스 합성곱

#### 대표적인 아키텍처 - FCN과 U-Net

##### FCN(Fully Convolutional Networks)

##### U-Net

#### 중간 예정 - 이미지 해상도 개선

##### FCN 구현

##### 이미지 업스케일링에 적용

## 의미론적 분할 이해하기
의미론적 분할(Semantic Segmentation)은 이미지를 의미 있는 부분으로 분할하는 작업을 지칭하는 좀 더 포괄적인 용어다. 객체 분할과 인스턴스 분할을 모두 아우른다. 이미지 분류와 객체 탐지와는 달리, 분할 작업에는 밀도 높은 픽셀 단위의 예측을 반환하는, 즉 입력 이미지의 각 픽셀마다 레이블을 할당하는 기법이 필요하다.

### 인코더-디코더를 사용한 객체 분할

#### 개요

##### 레이블 맵으로 디코딩하기

##### 분할 손실과 지표를 사용해 훈련하기

##### 조건부 랜덤 필드로 후처리

#### 고급 예제 - 자율 주행 자동차를 위한 이미지 분할

##### 작업 설명
자율 주행 자동차는 사람처럼 환경을 이해하고 주변을 둘러싼 요소들을 인지해야 한다. 전방 카메라로부터 유입되는 동영상 이미지에 의미론적 분할을 적용함으로써 시스템은 다른 자동차가 주변에 있는지 또는 보행자나 자전거가 길을 건너고 있지는 않은지를 알 수 있고 차선과 교통 신호를 지킬 수 있다.

##### 대표적인 솔루선

### 더 까다로운 인스턴스 분할

#### 객체 분할에서 인스턴스 분할까지

##### 경계를 고려하기

##### 사후 처리를 통해 인스턴스 마스크로 변환

#### 객체 탐지부터 인스턴스 분할까지 - Mask R-CNN

##### 의미론적 분할을 경계 상자에 적용하기

##### Faster R-CNN으로부터 인스턴스 분할 모델 구성하기

:bulb: 카이밍 히는 ResNet과 Faster R-CNN의 주 저자이다.

## 요약
픽셀 단위의 정확도를 필요로 하는 애플리케이션을 위한 다양한 패러다임을 다뤘다. 인코더-디코더와 일부 특수 아키텍처를 소개했고 이를 이미지 노이즈 제거에서 의미론적 분할에 이르기까지 여러 작업에 적용해 봤다. 또한 인스턴스 분할처럼 진화된 문제를 해결하기 위해 다양한 솔루션을 결합하는 방법도 보여줬다.

점점 더 복잡한 작업을 해결할수록 새로운 도전 과제들이 등장한다. 예를 들어 의미론적 분할의 경우 모델을 훈련시키기 위해 이미지에 정확하게 주석을 다는 일은 시간이 많이 걸린다. 따라서 활용할 수 있는 데이터셋은 부족하기 때문에 과적합을 피하기 위해 특별한 측정 기준이 필요하다. 게다가 훈련 이미지와 해당 이미지의 실제 정보가 더 무겁기 때문에 효율적인 훈련을 위해서는 잘 설계된 데이터 파이프라인이 필요하다.

## 질문

## 참고 문헌
