# 5장 디버깅 :fire:

프로그램의 복잡성은 컴포넌트 상호작용 방법의 가짓수와 관련있다.

상호작용 부분들의 수를 적게 만드는 테크닉으로는 정보 은닉, 추상화, 인터페이스, 프로그래밍 언어의 기능이 있다.

무결성을 보장하기 위한 테크닉으로는 프로그램 증명, 모델링, 요구사항 분석, 정형 검증이 있다.

디버깅 시간을 줄여주는 테크닉으로는 좋은 설계, 좋은 스타일, 경계 조건 테스트, assertion, sanity 체크, 방어적 프로그래밍, 잘 설계된 인터페이스, 한정된 전역 데이터, 검사도구가 있다.

## 5.1 디버거

열심히 생각한 다음 중요한 위치에 자기검증 코드나 출력문을 추가하는 편이 더 생산적이다.

## 5.2 실마리가 뚜렷한 쉬운 버그

### 자주 나오는 패턴을 찾으라

지역변수 초기화를 빠뜨리면 예전 같은 메모리 위쳉 저장됐던 쓰레기 값이 남을 수 있으며, malloc, realloc, new와 같은 메모리 할당 함수가 반환한 메모리에도 쓰레기 값이 채워져 있는 경우가 많다.

### 가장 최근에 변경한 부분을 검사하라

### 같은 실수를 두 번 반복하지 말라

### 오늘 할 디버깅을 내일로 미루지 말라

### 스택 추척값을 확인하라

### 작성하기 전에 읽으라

### 코드를 다른 사람에게 설명하라

## 5.3 실마리가 없는 어려운 버그

### 버그를 재현할 수 있게 하라

### 각개격파하라(Divide and Conquer)

### 수가 의미하는 바를 연구하라

### 결과를 출력해서 탐색 범위를 좁혀라

### 자가검증 코드를 작성하라

### 로그 파일을 작성하라

### 그림을 그려라

### 도구를 사용하라

### 기록하라

## 5.4 최후의 수단

## 5.5 재현 불가능한 버그

프로그램을 실행할 때마다 바뀌는 어떤 정보를 이용하는 부분에 있을 가능성이 높다는 의미이다.

모든 변수를 초기화했는지 확인하다. 이전에 같은 메모리 위치에 저장돼 있던 값을 제비 뽑듯이 우연히 뽑은 걸지도 모른다. 함수의 지역변수와 할당자로 받아온 메모리는 C와 C++에서 가장 혐의가 짙은 용의자다. 모든 변수에 정의된 값을 지정하라.

만약 디버깅용 코드를 넣자마자 버그 증상이 달라진다거나 아예 사라져버린다면, 아마 메모리 할당 에러일 가능성이 높다. 어디선가 할당된 메모리 바깥에 값을 썼기 때문에 디버깅용 코드를 넣자 저장공간의 배열 형태가 바뀌어서 버그 증상까지 영향을 준 것이다. printf부터 대화상자 창까지 대부분의 출력 함수는 자체적으로 메모리를 할당하기 떄문에 일을 더 혼란스럽게 만든다.

만약 사건 현장이 뭔가 문제가 발생할 수 있는 장소로부터 멀리 떨어져 있다면, 가장 의심스러운 것은 꽤나 나중에 사용하게 되는 메모리 위치에 값을 덮어쓴 문제다. 떄로는 지역변수에 대한 포인터를 부주의하게 함수에서 리턴해서 사용할 떄 발생하는 dangling pointer 문제도 의심해야한다. 지역변수의 주소를 리턴하는 짓은 재앙을 불러오는 주문이나 다름없다.

malloc과 free 함수의 어떤 버전은 대상의 메모리 해제 시도를 두 번 했을 때 그 내부 데이터 구조를 망가뜨리고 나서, 한참 뒤에, 뒤따른 호출이 이전에 생긴 구멍에 걸려 꽈당 넘어질 떄가 돼서야 문제를 드러낸다. 몇몇 할당자 함수에는 디버깅 옵션이 있어서 그것을 통해 검사하면 각 호출 때마다 그 정신 없는 현장의 일관성을 검증해 준다. 같은 입력에 동일한 결과가 나오지 않는 비결정적(nondeterministic)인 버그가 있다면 그 디버깅 옵션을 켜라. 그게 안 된다면, 그런 일관성 검증을 수행하거나, 매번 호출될 때마다 나중에 분석하기 위한 로그를 남기는 할당자를 손수 작성할 수도 있다. 빠른 속도로 동작할 필요가 없는 할당자는 작성하기 쉬우므로 급할 때는 이런 전략을 쓸 만하다. 또 메모리 관리를 검사해 주고 에러와 누수를 잡아주는 멋진 사용 제품들도 있다.

어떤 프로그램이 한 사람이 쓸 떄는 잘 돌아가는데 다른 사람이 쓰면 문제가 생긴다면, 뭔가가 프로그램의 외부 환경에 영향을 받고 있는 게 틀림없다. 아마 프로그램이 읽는 파일이나, 파일 권한, 환경 변수, 명령 프롬프트의 탐색 경로, 기본값, 부팅 파일 등과 관련이 있을 것이다. 이런 상황에서 다른 사람에게 조언을 주기는 쉽지 않다. 직접 그 사람의 입장에 서서 망가진 프로그램이 돌아가는 환경을 그대로 복사해 봐야하기 때문이다.

매달린 포인터(Dangling Pointer): 이미 메모리 공간이 반납된 포인터를 말한다. 지역 변수의 포인터를 리턴해서 쓰면 그 포인터를 사용하는 시점에 이미 그 공간이 반납된 상태기 떄문에 버그가 되는 것이다.

## 5.6 디버깅 툴

## 5.7 다른 사람의 버그

## 5.8 요약
